<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        /* Custom styles for left sidebar */
        .left-sidebar {
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
            width: 200px;
            background-color: #f8f9fa;
            padding-top: 20px;
            transition: width 0.3s;
        }

        .left-sidebar a {
            padding: 10px 15px;
            text-decoration: none;
            font-size: 18px;
            color: #333;
            display: block;
        }

        .left-sidebar a:hover {
            background-color: #007bff;
            color: white;
        }

        .left-sidebar.minimized {
            width: 60px;
        }

        .left-sidebar.minimized a {
            font-size: 0;
        }

        .left-sidebar.minimized a:before {
            font-size: 18px;
        }

        .left-sidebar.minimized .sidebar-heading,
        .left-sidebar.minimized .navbar-text {
            display: none;
        }

        .toggle-btn {
            position: absolute;
            top: 10px;
            right: -20px;
            background-color: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
        }

        .toggle-btn:hover {
            background-color: #0056b3;
        }

        .sidebar-separator {
            height: 1px;
            background-color: rgba(0, 0, 0, 0.1);
            margin: 10px 0;
        }

        .sidebar-heading {
            color: rgba(0, 0, 0, 0.5);
            font-size: 14px;
            margin-top: 15px;
            margin-bottom: 5px;
            padding: 5px;
            transition: opacity 0.3s;
        }

        .no-transition {
            transition: none !important;
        }

        /* Custom styles for right sidebar */
        .right-sidebar {
            height: 100%;
            position: fixed;
            top: 0;
            right: 0;
            width: 300px;
            background-color: #f8f9fa;
            padding-top: 20px;
            transition: right 0.3s, width 0.3s;
        }

        .right-sidebar.hidden {
            font-size: 0;
            right: -230px;
        }

        .right-sidebar.minimized {
            width: 60px;
            right: 0;
        }

        .right-sidebar{
            padding: 20px 15px;
            border-top: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
        }

        .right-sidebar a {
            padding: 10px 15px;
            text-decoration: none;
            font-size: 18px;
            color: #333;
            display: block;
        }

        .right-sidebar a:hover {
            background-color: #007bff;
            color: white;
        }

        .right-sidebar.minimized .notification,
        .right-sidebar.minimized .right-sidebar-heading {
            display: none;
        }

        .right-toggle-btn {
            position: fixed;
            top: 10px;
            right: 285px;
            background-color: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            transition: right 0.3s;
        }

        .right-toggle-btn.button-hidden {
            font-size: 16px;
            right: 55px;
        }

        .right-sidebar.hidden .notification,
        .right-sidebar.hidden .right-sidebar-heading {
            display: none; /* Hide notifications when sidebar is hidden */
        }

        .right-sidebar.minimized .notification,
        .right-sidebar.minimized .right-sidebar-heading {
            display: none; /* Hide notifications when sidebar is minimized */
        }

        /* Notification Styles */
        #notificationContainer {
            height: 87vh;
            overflow-y: auto;
            background-color: #f8f9fa;
            padding: 10px;
        }

        .notification {
            padding: 20px;
            margin-left: -10px;
            margin-right: -10px;
            margin-bottom: 20px;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .notification:last-child {
            border-bottom: none;
        }

        .notification strong {
            display: block;
            color: #333;
            font-size: 1.1em;
            margin-bottom: 5px;
            text-align: center;
        }

        .notification div {
            color: #555;
            font-size: 0.9em;
        }

        /* Button Styles */
        notification-button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            margin-bottom: -20px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s ease;
            text-align: center;
        }

        notification-button:hover {
            background-color: #218838;
        }

        /* Icon Styles */
        notification-button i {
            margin-right: 5px;
        }

        /* Alert Styles */
        .alert {
            color: red;
            margin-top: 10px;
        }

        /* Icon Colors */
        .left-sidebar a i {
            color: #6c757d; /* Default calm gray */
            transition: color 0.3s;
        }

        .left-sidebar a:hover i {
            color: #ffffff; /* Change icon color to white on hover */
        }

        /* Specific calmer colors for different icons */
        .left-sidebar a i.fa-home {
            color: #4caf50; /* Soft green for Home */
        }

        .left-sidebar a i.fa-list-ul {
            color: #ffc107; /* Soft amber for Projects */
        }

        .left-sidebar a i.fa-tasks {
            color: #17a2b8; /* Soft cyan for Tasks */
        }

        .left-sidebar a i.fa-comment-alt {
            color: #e63946; /* Soft red for Comments */
        }

        .left-sidebar a i.fa-user {
            color: #6f42c1; /* Soft purple for Profile */
        }

        .left-sidebar a i.fa-users,
        .left-sidebar a i.fa-comments,
        .left-sidebar a i.fa-folder-tree {
            color: #f77f00; /* Soft orange for Admin Functions */
        }

        .left-sidebar a i.fa-github {
            color: #4a4a4a; /* Calm dark gray for GitHub */
        }

        .left-sidebar a i.fa-google-drive {
            color: #db4437; /* Soft red for Google Drive */
        }

        .left-sidebar a i.fa-calendar-day {
            color: #fbbc05; /* Soft yellow for Google Calendar */
        }

        .left-sidebar a i.fa-square-facebook {
            color: #3b5998; /* Calm blue for Facebook */
        }

        .left-sidebar a i.fa-sign-out-alt {
            color: #e63946; /* Soft red for Logout */
        }
    </style>
    <script th:inline="javascript">
        function toggleSidebar() {
            let sidebar = document.getElementById("sidebar");
            sidebar.classList.toggle("minimized");
            localStorage.setItem('sidebarState', sidebar.classList.contains('minimized') ? 'minimized' : 'expanded');
        }

        function loadSidebarState() {
            let sidebar = document.getElementById("sidebar");
            let sidebarState = localStorage.getItem('sidebarState');
            if (sidebarState === 'minimized') {
                sidebar.classList.add('minimized');
            }
            setTimeout(function() {
                sidebar.classList.remove('no-transition');
            }, 0);

            let rightSidebar = document.getElementById("rightSidebar");
            let rightToggleBtn = document.getElementById("rightToggleBtn");
            let rightSidebarState = localStorage.getItem('rightSidebarState');
            if (rightSidebarState === 'expanded') {
                rightSidebar.classList.remove('hidden');
                rightToggleBtn.classList.remove('button-hidden');
            }
            setTimeout(function() {
                rightSidebar.classList.remove('no-transition');
                rightToggleBtn.classList.remove('no-transition');
            }, 0);
        }

        function toggleRightSidebar() {
            let rightSidebar = document.getElementById("rightSidebar");
            let rightToggleBtn = document.getElementById("rightToggleBtn");
            rightSidebar.classList.toggle("hidden");
            rightToggleBtn.classList.toggle("button-hidden");
            localStorage.setItem('rightSidebarState', rightSidebar.classList.contains('hidden') ? 'hidden' : 'expanded');
        }

        document.addEventListener("DOMContentLoaded", function() {
            const userId = /*[[${#authentication.getPrincipal().getId()}]]*/ 0;
            fetchNotifications(userId);
        });

        function fetchNotifications(userId) {
            fetch(`/notifications/user/${userId}`)
                .then(response => response.json())
                .then(notifications => {
                    const notificationContainer = document.getElementById("notificationContainer");
                    const notificationCount = document.getElementById("notificationCount");
                    notificationContainer.innerHTML = ''; // Clear current notifications
                    const count = notifications.length; // Get notification count

                    notificationCount.innerText = count; // Update notification count

                    // Show or hide the badge based on the count
                    notificationCount.style.display = count > 0 ? 'inline' : 'none';

                    notifications.forEach(notification => {
                        const notificationDiv = document.createElement("div");
                        notificationDiv.classList.add("notification");
                        notificationDiv.innerHTML = `
                    <strong class="card-title">${notification.title}</strong>
                    <div class="card-body text-center">${notification.message}</div>
                    <notification-button onclick="deleteNotification(${notification.id}, ${userId})">
                        <i class="fa-solid fa-check"></i> Mark as Read
                    </notification-button>
                    <hr/>
                `;
                        notificationContainer.appendChild(notificationDiv);
                    });
                })
                .catch(error => console.error('Error fetching notifications:', error));
        }

        function deleteNotification(notificationId, userId) {
            const csrfToken = /*[[${_csrf.token}]]*/ '';
            fetch(`/notifications/user/${userId}/delete/${notificationId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': csrfToken,
                },
            })
                .then(response => {
                    if (response.ok) {
                        fetchNotifications(userId); // Refresh notifications after deletion
                    } else {
                        alert('Error marking notification as read.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
    </script>
    <title>Home Page</title>
</head>
<body onload="loadSidebarState()">
<div class="left-sidebar no-transition" id="sidebar">
    <button class="toggle-btn" onclick="toggleSidebar()">&#9776;</button>
    <span class="navbar-text mr-2" style="padding: 15px">
        <span style="font-size: 18px;">👋 Hello,</span>
        <a class="nav-link d-inline" th:href="@{|/users/${#authentication.principal.id}/read|}" style="padding: 5px">
            <span sec:authentication="principal.firstName"></span>
        </a>
    </span>

    <div class="sidebar-separator"></div>

    <h6 class="sidebar-heading">General Functions</h6>
    <a th:href="@{/}"><i class="fas fa-home"></i> Home</a>
    <a th:href="@{/todos/all/users/{userId}(userId=${#authentication.principal.id})}"><i class="fas fa-list-ul"></i> Projects</a>
    <a th:href="@{/tasks/all/users/{userId}(userId=${#authentication.principal.id})}"><i class="fas fa-tasks"></i> Tasks</a>
    <a th:href="@{/comments/all/users/{userId}(userId=${#authentication.principal.id})}"><i class="fas fa-comment-alt"></i> Comments</a>
    <a th:href="@{/users/{userId}/read(userId=${#authentication.principal.id})}"><i class="fas fa-user"></i> Profile</a>

    <div sec:authorize="isAuthenticated() and hasAuthority('ADMIN')">
        <div class="sidebar-separator"></div>
        <h6 class="sidebar-heading">Admin Functions</h6>
        <a th:href="@{/users/all}"><i class="fas fa-users"></i> All Users</a>
        <a th:href="@{/comments/all}"><i class="fas fa-comments"></i> All Comments</a>
        <a th:href="@{/todos/all(user_id=${#authentication.principal.id})}"><i class="fa-solid fa-folder-tree"></i> All Projects</a>
    </div>

    <div sec:authorize="isAuthenticated() and #authentication.principal.isGitHubConnected()">
        <div class="sidebar-separator"></div>
        <h6 class="sidebar-heading">GitHub Functions</h6>
        <a th:href="@{/github/repos}"><i class="fab fa-github"></i> GitHub Repos</a>
    </div>

    <div sec:authorize="isAuthenticated() and #authentication.principal.isGoogleConnected()">
        <div class="sidebar-separator"></div>
        <h6 class="sidebar-heading">Google Shortcuts</h6>
        <a th:href="@{https://drive.google.com/drive/my-drive}" target="_blank" rel="noopener noreferrer">
            <i class="fa-brands fa-google-drive"></i> Google Drive
        </a>
        <a href="https://calendar.google.com" target="_blank" rel="noopener noreferrer">
            <i class="fa-solid fa-calendar-day"></i> Google Calendar
        </a>
    </div>

    <div sec:authorize="isAuthenticated() and #authentication.principal.isFacebookConnected()">
        <div class="sidebar-separator"></div>
        <h6 class="sidebar-heading">Facebook Shortcuts</h6>
        <a th:href="@{https://www.facebook.com/home.php}" target="_blank" rel="noopener noreferrer">
            <i class="fa-brands fa-square-facebook"></i> Facebook Home
        </a>
        <a href="https://www.facebook.com/events" target="_blank" rel="noopener noreferrer">
            <i class="fa-solid fa-calendar-day"></i> Facebook Events
        </a>
    </div>

    <div class="sidebar-separator"></div>

    <h6 class="sidebar-heading">Logout</h6>
    <a th:href="@{/logout}"><i class="fas fa-sign-out-alt"></i> Logout</a>

    <div class="sidebar-separator"></div>
</div>

<div class="right-sidebar hidden no-transition" id="rightSidebar">
    <button class="right-toggle-btn button-hidden no-transition" id="rightToggleBtn" onclick="toggleRightSidebar()">
        &#9776;
        <span id="notificationCount" class="badge badge-danger" style="font-size: 12px; margin-left: 5px; display: none;">0</span>
    </button>

    <h6 class="right-sidebar-heading text-center" style="font-size: 18px"><i class="fas fa-bell"></i> Notifications</h6>
    <div class="sidebar-separator"></div>
    <div id="notificationContainer" class="card-body">
        <!-- Notifications will be dynamically inserted here -->
    </div>
</div>

</body>
</html>